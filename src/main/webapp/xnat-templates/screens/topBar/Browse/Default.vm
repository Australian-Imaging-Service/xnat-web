<!-- Sequence: 10 -->
<!-- Browse/Default -->
    <li><a href="#BrowseProjects">Projects</a>
        <ul id="browse-projects">
            <!-- Sequence: 10 -->
            <li class="create-project hidden"><a href="$link.setPage("XDATScreen_add_xnat_projectData.vm")">$displayManager.getSingularDisplayNameForProject()</a></li>
        </ul>
    </li>
    <li class="hidden"><a href="#FavoriteProjects">Favorite Projects</a>
        <ul id="favorite-projects">
            <!-- Sequence: 10 -->
        </ul>
    </li>
    <li><a href="#BrowseData">Data</a>
        <ul id="browse-data">
            <!-- Sequence: 10 -->
        </ul>
    </li>

<script>
    var displayProjectNav = function(projectList) {
        for (p in projectList) {
            var pLink = '<li><a href="'+serverRoot+'/data/projects/'+projectList[p].id+'">'+projectList[p].name+'</a></li>';
            $('#browse-projects').append(pLink);
        };
    };
    var displayFavoriteProjects = function(projectList) {
        if (projectList.length > 0) {
            for (p in projectList) {
                var pLink = '<li><a href="'+serverRoot+'/data/projects/'+projectList[p].id+'">'+projectList[p].name+'</a></li>';
                $('#favorite-projects').append(pLink);
            };
            $('#favorite-projects').parent('li').removeClass('hidden');
        }
    }

    var displayProjectNavFail = function() {
        $('#browse-projects').find('.create-project').removeClass('hidden');
    };

    var displayDataNav = function() {
        var dataTypes = window.available_elements;
        for (d in dataTypes) {
            if (dataTypes[d].plural !== undefined && dataTypes[d].element_name !== 'wrk:workflowData') {
                var dLink = '<li><a href="'+serverRoot+'/app/template/Search.vm/node/d.'+dataTypes[d].element_name+'">'+dataTypes[d].plural+'</a></li>';
                $('#browse-data').append(dLink);
            }
        };
    };
    $(document).ready(function(){
        // populate project list
        $.getJSON(serverRoot+'/data/projects?accessible=true&XNAT_CSRF='+csrfToken)
            .success(function(data){ displayProjectNav(data.ResultSet.Result) })
            .fail(function() { displayProjectNavFail(); });

        // look for favorite projects. If found, show that dropdown list.
        $.getJSON(serverRoot+'/data/projects?favorite=true&format=json&XNAT_CSRF='+csrfToken)
            .success(function(data) { displayFavoriteProjects(data.ResultSet.Result) })
            .fail(function() { /* set Favorite Projects nav item to hidden, if necessary */ });

        // populate data list
        if (window.available_elements !== undefined) {
            displayDataNav();
        } else {
            $('#browse-data').parent('li').addClass('disabled');
        }
    });
</script>
